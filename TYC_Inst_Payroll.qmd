---
title: "Monthly Payroll"
format: pdf
editor: visual
params:
  month: "02"
  year: "2024"
  payroll_folder_url: "https://drive.google.com/drive/folders/1NGyvhDrOaOrXI-kKMb29z0KBs3wX6qRl"
  google_user_email: "andymaffei@gmail.com"
  payrate_file_name: "tyc-payrates"
  payroll_csv_prefix: "tyc_wlpayroll"
  instructor_file_name: "tyc-instructors"
  output_pdf_folder: "instructor_pdfs"
---

## TYC Monthly Payroll

This is a log of the monthly payroll run for The Yoga Collaborative.

## Initialize the payroll run

```{r}
#| echo: false
#| include: false
#| results: hide

# Load required libraries
library(tidyverse)
library(shiny)
library(quarto)
library(googledrive)
library(googlesheets4)
library(gt)

# Authorize google access 
gs4_auth(email=params$google_user_email)

# Extract the ID from the URL
payroll_folder_id <- gsub(".*/folders/(.*)$", "\\1", 
                  params$payroll_folder_url)

# Get directory listing for the top level payroll folder
payroll_folder_dirlist <- drive_ls(path = 
                                     as_id(payroll_folder_id))

```

## Payrate Table for this month

```{r}
#| echo: false
#| include: true

# Generate payrate table
payrate_file <-  payroll_folder_dirlist |>
  filter(name == params$payrate_file_name)
payrate_tbl <- read_sheet(payrate_file$id) |>
  rename(
    hourly_pay_rate = `WL Hourly Payrate`,
    pp7 = PP7,
    cap = Cap,
    base0 = `Base 0`,
    base1 = `Base 1 Plus`)

# Display the table in the report
gt(payrate_tbl, rowname_col = "hourly_pay_rate") |>
   fmt_currency(columns = c(cap, base1, pp7, base0)) |>
   cols_label(hourly_pay_rate = "Hourly Pay Rate", 
              cap = "Cap", 
              base1 = "Base 1",
              pp7 = "PP7",
              base0 = "Base 0")
```

## Employee Table for this Month

```{r}
#| echo: false
#| include: true

# Generate Instructor Table
instructor_file <- payroll_folder_dirlist |>
  filter(name == params$instructor_file_name)
instructor_tbl <- read_sheet(instructor_file$id) |>
  rename(
    name = Name,
    instructor_pay_rate = 'Hourly Pay Rate',
    anniversary_date = 'Anniversary Date'
  )

# Display the table in the report
gt(instructor_tbl) |>
   cols_label(name = "Name", 
              instructor_pay_rate = "Hourly Pay Rate",
              anniversary_date = "Anniversary Date")
```
